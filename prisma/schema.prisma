generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model activity_logs {
  id          String   @id
  user_id     String?
  action      String
  entity      String
  entity_id   String?
  description String?
  ip_address  String?
  user_agent  String?
  metadata    Json?
  created_at  DateTime @default(now())
  users       users?   @relation(fields: [user_id], references: [id])

  @@index([created_at])
  @@index([entity])
  @@index([user_id])
}

model categories {
  id               String       @id
  name             String
  code             String       @unique
  description      String?
  parent_id        String?
  icon             String?
  color            String?
  sort_order       Int          @default(0)
  is_active        Boolean      @default(true)
  created_at       DateTime     @default(now())
  updated_at       DateTime
  categories       categories?  @relation("categoriesTocategories", fields: [parent_id], references: [id])
  other_categories categories[] @relation("categoriesTocategories")
  reports          reports[]
}

model departments {
  id                String        @id
  name              String
  code              String        @unique
  description       String?
  parent_id         String?
  is_active         Boolean       @default(true)
  created_at        DateTime      @default(now())
  updated_at        DateTime
  departments       departments?  @relation("departmentsTodepartments", fields: [parent_id], references: [id])
  other_departments departments[] @relation("departmentsTodepartments")
  reports           reports[]
  users             users[]
}

model downloads {
  id         String   @id
  user_id    String
  report_id  String
  ip_address String
  user_agent String
  created_at DateTime @default(now())
  reports    reports  @relation(fields: [report_id], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([report_id])
  @@index([user_id])
}

model favorites {
  id         String   @id
  user_id    String
  report_id  String
  created_at DateTime @default(now())
  reports    reports  @relation(fields: [report_id], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, report_id])
}

model notifications {
  id         String           @id
  user_id    String
  type       NotificationType
  title      String
  message    String
  link       String?
  is_read    Boolean          @default(false)
  read_at    DateTime?
  created_at DateTime         @default(now())
  users      users            @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([is_read])
  @@index([user_id])
}

model permissions {
  id               String             @id
  name             String             @unique
  display_name     String
  category         String
  description      String?
  created_at       DateTime           @default(now())
  updated_at       DateTime
  role_permissions role_permissions[]
}

model report_shares {
  id           String    @id
  report_id    String
  shared_by    String
  shared_with  String?
  share_token  String?   @unique
  share_type   ShareType
  can_download Boolean   @default(true)
  can_edit     Boolean   @default(false)
  expires_at   DateTime?
  created_at   DateTime  @default(now())
  reports      reports   @relation(fields: [report_id], references: [id], onDelete: Cascade)
  users        users     @relation(fields: [shared_by], references: [id], onDelete: Cascade)
}

model report_tags {
  id         String   @id
  report_id  String
  tag_id     String
  created_at DateTime @default(now())
  reports    reports  @relation(fields: [report_id], references: [id], onDelete: Cascade)
  tags       tags     @relation(fields: [tag_id], references: [id], onDelete: Cascade)

  @@unique([report_id, tag_id])
}

model report_versions {
  id         String   @id
  report_id  String
  version    String
  file_path  String
  file_name  String
  file_size  BigInt
  change_log String?
  created_by String
  created_at DateTime @default(now())
  reports    reports  @relation(fields: [report_id], references: [id], onDelete: Cascade)
}

model reports {
  id              String            @id
  code            String            @unique
  name_th         String
  name_en         String?
  description     String?
  file_path       String
  file_name       String
  file_type       String
  file_size       BigInt
  thumbnail_path  String?
  category_id     String
  department_id   String?
  created_by_id   String
  author          String?
  report_date     DateTime?
  version         String            @default("1.0")
  status          ReportStatus      @default(DRAFT)
  access_level    AccessLevel       @default(PUBLIC)
  is_downloadable Boolean           @default(true)
  is_editable     Boolean           @default(true)
  view_count      Int               @default(0)
  download_count  Int               @default(0)
  published_at    DateTime?
  archived_at     DateTime?
  created_at      DateTime          @default(now())
  updated_at      DateTime
  downloads       downloads[]
  favorites       favorites[]
  report_shares   report_shares[]
  report_tags     report_tags[]
  report_versions report_versions[]
  categories      categories        @relation(fields: [category_id], references: [id])
  users           users             @relation(fields: [created_by_id], references: [id])
  departments     departments?      @relation(fields: [department_id], references: [id])

  @@index([category_id])
  @@index([code])
  @@index([created_at])
  @@index([status])
}

model role_permissions {
  id            String      @id
  role_id       String
  permission_id String
  created_at    DateTime    @default(now())
  permissions   permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade)
  roles         roles       @relation(fields: [role_id], references: [id], onDelete: Cascade)

  @@unique([role_id, permission_id])
}

model roles {
  id               String             @id
  name             String             @unique
  display_name     String
  description      String?
  is_system        Boolean            @default(false)
  created_at       DateTime           @default(now())
  updated_at       DateTime
  role_permissions role_permissions[]
  user_roles       user_roles[]
}

model settings {
  id          String   @id
  key         String   @unique
  value       String
  type        String
  category    String
  description String?
  is_public   Boolean  @default(false)
  created_at  DateTime @default(now())
  updated_at  DateTime
}

model support_tickets {
  id            String         @id
  ticket_number String         @unique
  user_id       String
  subject       String
  description   String
  category      String
  priority      TicketPriority
  status        TicketStatus   @default(OPEN)
  assigned_to   String?
  resolved_at   DateTime?
  created_at    DateTime       @default(now())
  updated_at    DateTime
  users         users          @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([priority])
  @@index([status])
}

model tags {
  id          String        @id
  name        String        @unique
  slug        String        @unique
  description String?
  usage_count Int           @default(0)
  created_at  DateTime      @default(now())
  updated_at  DateTime
  report_tags report_tags[]
}

model user_roles {
  id         String   @id
  user_id    String
  role_id    String
  created_at DateTime @default(now())
  roles      roles    @relation(fields: [role_id], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, role_id])
}

model user_sessions {
  id         String   @id
  user_id    String
  token      String   @unique
  ip_address String
  user_agent String
  expires_at DateTime
  created_at DateTime @default(now())
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model users {
  id                  String            @id
  username            String            @unique
  email               String            @unique
  password            String
  first_name          String?
  last_name           String?
  phone_number        String?
  profile_image       String?
  position            String?
  department_id       String?
  status              UserStatus        @default(ACTIVE)
  email_verified      Boolean           @default(false)
  two_factor_enabled  Boolean           @default(false)
  two_factor_secret   String?
  last_login_at       DateTime?
  last_login_ip       String?
  password_changed_at DateTime?
  created_at          DateTime          @default(now())
  updated_at          DateTime
  activity_logs       activity_logs[]
  downloads           downloads[]
  favorites           favorites[]
  notifications       notifications[]
  report_shares       report_shares[]
  reports             reports[]
  support_tickets     support_tickets[]
  user_roles          user_roles[]
  user_sessions       user_sessions[]
  departments         departments?      @relation(fields: [department_id], references: [id])
}

enum AccessLevel {
  PUBLIC
  RESTRICTED
  PRIVATE
}

enum NotificationType {
  USER_CREATED
  PASSWORD_CHANGED
  PERMISSION_CHANGED
  ACCOUNT_SUSPENDED
  REPORT_NEW
  REPORT_SHARED
  REPORT_UPDATED
  REPORT_EXPIRING
  SYSTEM_STORAGE_LOW
  SYSTEM_MAINTENANCE
  SYSTEM_UPDATE
  SYSTEM_ERROR
}

enum ReportStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ShareType {
  USER
  DEPARTMENT
  LINK
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}
